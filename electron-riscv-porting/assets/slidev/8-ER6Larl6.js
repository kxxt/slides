import{_ as A}from"./CodeBlockWrapper-DyKudgfG.js";import{I as m}from"./default-BuSUeIOv.js";import{_,af as d}from"../index-CTXhHEjE.js";import{p as c,u as g,f as D}from"./context-DTbR1Zcq.js";import{o as E,c as b,k as a,e as s,l,m as h,q as C,s as B,a7 as i}from"../modules/vue-2fpiEc3Z.js";import"../modules/unplugin-icons-CvLVkzgj.js";import"../modules/shiki-CJnnXe8e.js";const v={__name:"8",setup(u,{expose:n}){n(),c(d);const{$slidev:r,$nav:t,$clicksContext:k,$clicks:o,$page:e,$renderContext:y,$frontmatter:f}=g(),p={$slidev:r,$nav:t,$clicksContext:k,$clicks:o,$page:e,$renderContext:y,$frontmatter:f,InjectedLayout:m,get frontmatter(){return d},get useSlideContext(){return g},get _provideFrontmatter(){return c},get _frontmatterToProps(){return D}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}},x=s("p",{style:{position:"absolute",left:"17em",top:"3.6em"}},[i(" BTW, "),s("a",{href:"https://github.com/llvm/llvm-project/issues/79944"},"https://github.com/llvm/llvm-project/issues/79944")],-1),$=s("h1",null,"How does this complicates the RISC-V port?",-1),P=s("p",null,"To follow upstream’s approach",-1),T=s("ul",null,[s("li",null,[s("a",{href:"https://github.com/riscv-forks/electron/blob/README/sysroot.patch",target:"_blank"},"A separately maintained patch"),i(" to create debian sysroots for riscv64.")]),s("li",null,[i("Chroimum’s clang build is missing some riscv64 parts(e.g. compiler-rt), so for cross-compilation, "),s("a",{href:"https://github.com/riscv-forks/electron/blob/v30.1.1-riscv/patches/chromium/0001-clang-add-riscv64-support-to-package-script.patch",target:"_blank"},"we need to build clang ourselves"),i(".")]),s("li",null,[i("Rust also needs to be built because of "),s("a",{href:"https://github.com/rust-lang/rust/issues/121924",target:"_blank"},"#121924"),i(". I fixed it in "),s("a",{href:"https://github.com/rust-lang/rust/pull/123612",target:"_blank"},"#123612"),i(". This fix has landed in rust 1.79.0 (Released on 13 June).")])],-1),w={style:{float:"left","--prism-font-size":"1rem"}},F=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light slidev-code",style:{"--shiki-dark":"#dbd7caee","--shiki-light":"#393a34","--shiki-dark-bg":"#121212","--shiki-light-bg":"#ffffff"}},[s("code",{class:"language-c"},[s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}},"// reproducer.c")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"extern"),s("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}}," void"),s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}}," hello"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"();")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"int"),s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}}," test"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}}," ()"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}},"  hello"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"();"),s("span",{style:{"--shiki-dark":"#4D9375","--shiki-light":"#1E754F"}},"return"),s("span",{style:{"--shiki-dark":"#4C9A91","--shiki-light":"#2F798A"}}," 0"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},";")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"}")])])],-1),I=s("p",null,"Cross Language LTO",-1),S=s("p",null,"is broken on RISC-V",-1),j={style:{float:"left","--prism-font-size":"1rem"}},R=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light slidev-code",style:{"--shiki-dark":"#dbd7caee","--shiki-light":"#393a34","--shiki-dark-bg":"#121212","--shiki-light-bg":"#ffffff"}},[s("code",{class:"language-rust"},[s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#758575DD","--shiki-light":"#A0ADA0"}},"// reproducer.rs")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"#"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"!"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"["),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"feature"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"("),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"no_core"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},")]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"#"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"!"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"["),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"feature"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"("),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"lang_items"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},")]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"#"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"!"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"["),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"no_std"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"#"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"!"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"["),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"no_core"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"#["),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"lang "),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"="),s("span",{style:{"--shiki-dark":"#C98A7D99","--shiki-light":"#B5695999"}},' "'),s("span",{style:{"--shiki-dark":"#C98A7D","--shiki-light":"#B56959"}},"sized"),s("span",{style:{"--shiki-dark":"#C98A7D99","--shiki-light":"#B5695999"}},'"'),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#CB7676","--shiki-light":"#AB5959"}},"trait"),s("span",{style:{"--shiki-dark":"#5DA994","--shiki-light":"#2E8F82"}}," Sized"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}}," {}")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"#["),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"no_mangle"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"]")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#4D9375","--shiki-light":"#1E754F"}},"pub"),s("span",{style:{"--shiki-dark":"#4D9375","--shiki-light":"#1E754F"}}," fn"),s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}}," hello"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},"()"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}}," {}")])])],-1),z=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light slidev-code",style:{"--shiki-dark":"#dbd7caee","--shiki-light":"#393a34","--shiki-dark-bg":"#121212","--shiki-light-bg":"#ffffff"}},[s("code",{class:"language-makefile"},[s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#B8A965","--shiki-light":"#998418"}},".PHONY"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},":"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}}," clean")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}},"libreproducer.so"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},":"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}}," reproducer.o libreproducer.rlib")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"	clang --target=riscv64-linux-gnu -flto=thin -march=rv64gc -mabi=lp64d -fuse-ld=lld -shared -nostdlib -o "),s("span",{style:{"--shiki-dark":"#C99076","--shiki-light":"#A65E2B"}},"$@"),s("span",{style:{"--shiki-dark":"#C99076","--shiki-light":"#A65E2B"}}," $^")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}},"libreproducer.rlib"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},":"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}}," reproducer.rs rust-toolchain")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"	rustc --target riscv64gc-unknown-linux-gnu -Clinker-plugin-lto -Cpanic=abort --crate-type=rlib reproducer.rs")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#80A665","--shiki-light":"#59873A"}},"reproducer.o"),s("span",{style:{"--shiki-dark":"#666666","--shiki-light":"#999999"}},":"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}}," reproducer.c")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}},"	clang --target=riscv64-linux-gnu -march=rv64gc -mabi=lp64d -flto=thin -O2 -c "),s("span",{style:{"--shiki-dark":"#C99076","--shiki-light":"#A65E2B"}},"$<"),s("span",{style:{"--shiki-dark":"#DBD7CAEE","--shiki-light":"#393A34"}}," -o "),s("span",{style:{"--shiki-dark":"#C99076","--shiki-light":"#A65E2B"}},"$@")])])],-1),V=s("pre",{class:"shiki shiki-themes vitesse-dark vitesse-light slidev-code",style:{"--shiki-dark":"#dbd7caee","--shiki-light":"#393a34","--shiki-dark-bg":"#121212","--shiki-light-bg":"#ffffff"}},[s("code",{class:"language-text"},[s("span",{class:"line"},[s("span",null,"ld.lld: error: lto.tmp: cannot link object files with")]),i(`
`),s("span",{class:"line"},[s("span",null,"different floating-point ABI from lto.tmp")]),i(`
`),s("span",{class:"line"},[s("span",null,"clang: error: linker command failed with exit code 1 (use -v to see invocation)")])])],-1);function L(u,n,r,t,k,o){const e=A;return E(),b(t.InjectedLayout,C(B(t._frontmatterToProps(t.frontmatter,7))),{default:a(()=>[x,$,P,T,s("div",w,[l(e,h({},{ranges:[]}),{default:a(()=>[F]),_:1},16),I,S]),s("div",j,[l(e,h({},{ranges:[]}),{default:a(()=>[R]),_:1},16)]),l(e,h({},{ranges:[]}),{default:a(()=>[z]),_:1},16),V]),_:1},16)}const Y=_(v,[["render",L],["__file","/@slidev/slides/8.md"]]);export{Y as default};
